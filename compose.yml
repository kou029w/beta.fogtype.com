services:
  caddy:
    image: git.fogtype.com/nebel/caddy-docker-proxy
    build: "."
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443/udp"
      - "443:443/tcp"
      - "127.0.0.1:2019:2019"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - caddy_data:/data
      - caddy_config:/config
  portainer:
    image: portainer/portainer-ce:2.17.0-alpine@sha256:4c3e6dfd21f2b89c6f3ed3c581012f06a8e23415fea7fc03f9c94c563d2b622d
    restart: unless-stopped
    labels:
      caddy: beta.fogtype.com
      caddy.reverse_proxy: "{{upstreams 9000}}"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
networks:
  default:
    name: caddy
volumes:
  caddy_data:
  caddy_config:
  portainer_data:
